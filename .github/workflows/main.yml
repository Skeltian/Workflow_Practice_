name: "Paclet Site Generation TEST"

on: [workflow_dispatch]

jobs:
  job:
    runs-on: [self-hosted]
    steps:
      - name: "Checkout my repository"
        uses: actions/checkout@v2
        
      - name: "Create the paclet file"
        run: |
          $FILES = @(Get-ChildItem -Path './') | Where-Object {$_ -notlike ".github"};
          foreach ($file in $FILES) {
            wolframscript -code "CreatePacletArchive[`"./$file`"]";
            Move-Item -Path "./$file-1.0.0.paclet" -Destination "./$file/Paclets/$file-1.0.0.paclet"
            wolframscript -code "PacletManager`BuildPacletSiteFiles[`"./$file`"]"
          }
        
      - name: "Commit the files"
        run: |
          git add *
          git commit -m "Auto-generated and handled the PacletSite creation"
          git push -u origin
